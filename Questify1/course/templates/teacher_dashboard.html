{% extends "base.html" %}

{% block content %}
<h2>–ü–∞–Ω–µ–ª—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</h2>
<p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</p>
<!-- –ö–Ω–æ–ø–∫–∏ -->
<div class="d-flex gap-2 mb-4">
  <a href="{% url 'course:course_add' %}" class="btn btn-success">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å</a>
  <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#progressModal">
    üìä –°–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
  </button>
</div>

{% for course in courses %}
<div class="card mb-3 shadow-sm">
  <div class="card-body">
    <h5>{{ course.title }}</h5>
    <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> {{ course.get_level_display }}</p>
    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
      {% for cat in course.category.all %}
        {{ cat.name }}{% if not forloop.last %}, {% endif %}
      {% empty %}–ù–µ—Ç{% endfor %}
    </p>
    <a href="{% url 'course:course_edit' course.pk %}" class="btn btn-sm btn-primary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å</a>
    <a href="{% url 'course:course_delete' course.pk %}" class="btn btn-sm btn-danger">–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å</a>

    <h6 class="mt-3">–£—Ä–æ–∫–∏:</h6>
    <ul>
      {% for lesson in course.lessons.all %}
        <li>
          {{ lesson.title }}
          <a href="{% url 'course:lesson_edit' lesson.pk %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è</a>
          <a href="{% url 'course:lesson_delete' lesson.pk %}" class="btn btn-sm btn-outline-danger">üóëÔ∏è</a>
          <a href="{% url 'course:generate_quiz' lesson.id %}" class="btn btn-sm btn-primary">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç</a>
        </li>
      {% empty %}
        <li>–£—Ä–æ–∫–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</li>
      {% endfor %}
    </ul>
    <a href="{% url 'course:lesson_add' course.pk %}" class="btn btn-sm btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫</a>
  </div>
</div>
{% empty %}
<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤.</p>
{% endfor %}
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
<div class="modal fade" id="progressModal" tabindex="-1" aria-labelledby="progressModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="progressModalLabel">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ –∫—É—Ä—Å–∞–º</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <div class="modal-body">
        {% if progress_data %}
        <div class="table-responsive">
          <table class="table align-middle table-striped">
            <thead class="table-light">
              <tr>
                <th>–ö—É—Ä—Å</th>
                <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                <th>–ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Ä–æ–∫–æ–≤</th>
                <th>–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤</th>
                <th>–û—Ü–µ–Ω–∫–∞</th>
                <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
              </tr>
            </thead>
            <tbody>
              {% for record in progress_data %}
              <tr>
                <td>{{ record.course.title }}</td>
                <td>{{ record.student.username }}</td>
                <td>{{ record.completed_lessons }}</td>
                <td>{{ record.total_lessons }}</td>
                <td>{{ record.score }}</td>
                <td style="width: 25%;">
                  <div class="progress" style="height: 20px;">
                    <div class="progress-bar 
                      {% if record.progress_percent >= 80 %}bg-success
                      {% elif record.progress_percent >= 50 %}bg-warning
                      {% else %}bg-danger{% endif %}"
                      style="width: {{ record.progress_percent }}%">
                      {{ record.progress_percent }}%
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.</p>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
