{% extends "base.html" %}
{% load quiz_extras %}

{% block content %}
<h2>–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç: {{ quiz.lesson.title }}</h2>

<form method="post">
    {% csrf_token %}
    <ol>
    {% for q in questions %}
        <li class="mb-3">
            <strong>{{ q.text }}</strong>
            <div class="quiz-options mt-2">
                {% for option in "A,B,C,D"|split:"," %}
                    {% with option_text=q|get_option_text:option %}
                    <div class="form-check"
                        {% if completed %}
                            {% if option == q.correct_answer %}
                                style="background-color: #d4edda;"  {# –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ #}
                            {% elif option == student_answers|get_answer:q.id %}
                                style="background-color: #f8d7da;"  {# –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ #}
                            {% endif %}
                        {% endif %}
                    >
                        <input class="form-check-input" type="radio" 
                               name="question_{{ q.id }}" 
                               id="q{{ q.id }}_{{ option }}" 
                               value="{{ option }}"
                               {% if option == student_answers|get_answer:q.id %}checked{% endif %}
                               {% if completed %}disabled{% endif %}>
                        <label class="form-check-label" for="q{{ q.id }}_{{ option }}">
                            {{ option_text }}
                        </label>
                    </div>
                    {% endwith %}
                {% endfor %}

                <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ -->
                <button type="button" class="btn btn-link text-primary p-0 mt-1"
                        onclick="getHint({{ q.id }})">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
                <div id="hint-{{ q.id }}" class="text-muted small mt-1"></div>
            </div>
        </li>
    {% endfor %}
    </ol>

    {% if not completed %}
        <button type="submit" class="btn btn-primary mt-3">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã</button>
    {% else %}
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç: {{ score }} / {{ total }}</h3>
        <a href="{% url 'course:student_courses' %}" class="btn btn-secondary mt-3">‚Üê –ù–∞–∑–∞–¥ –∫ –º–æ–∏–º –∫—É—Ä—Å–∞–º</a>
    {% endif %}
</form>

<script>
function getHint(questionId) {
    fetch(`/course/hint/${questionId}/`)
        .then(response => response.json())
        .then(data => {
            document.getElementById(`hint-${questionId}`).innerText = data.hint;
        })
        .catch(err => {
            document.getElementById(`hint-${questionId}`).innerText = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏.";
        });
}
</script>
{% endblock %}
